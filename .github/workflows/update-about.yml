name: Update about.md
on:
  push:
  workflow_dispatch:
jobs:
  parse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          repository: Kagerou-Discord/Kagerou
      - name: Install hclq
        run: |
          curl -sSLo install.sh https://install.hclq.sh
          sh install.sh
      - name: Remove external references
        run: |
          sed -i "s/discord_category_channel./\"/g" text_ch.tf
          sed -i -e "s/\.id$/\"/g" text_ch.tf
          sed -i "s/local.server_id/0/g" text_ch.tf
      - run: |
          format_as_arr () {
            local STR=$1
            STR=${STR#[}
            STR=${STR%]}
            STR=${STR//\"/}
            echo $STR | tr "," "\n"
          }

          NAMES=($(format_as_arr $(cat text_ch.tf | hclq get 'resource.discord_text_channel.*.name')))
          TOPICS=($(format_as_arr $(cat text_ch.tf | hclq get 'resource.discord_text_channel.*.topic')))
          CATS=($(format_as_arr $(cat text_ch.tf | hclq get 'resource.discord_text_channel.*.category')))

          for name in ${!NAMES[@]}; do
            echo ${NAMES[$i]}
            echo ${TOPICS[$i]}
            echo ${CATS[$i]}
            echo "\n"
          done

          echo ${NAMES[@]}
          echo ${TOPICS[@]}
          echo ${CATS[@]}
      # TODO: カテゴリをhuman readableに置き換える
